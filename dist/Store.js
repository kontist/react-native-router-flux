Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.actionMap=void 0;var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _reactNavigation=require("react-navigation");var _reactNavigationStack=require("react-navigation-stack");var _reactNavigationDrawer=require("react-navigation-drawer");var _reactNavigationTabs=require("react-navigation-tabs");var _propTypes=_interopRequireDefault(require("prop-types"));var _Reducer=_interopRequireDefault(require("./Reducer"));var ActionConst=_interopRequireWildcard(require("./ActionConst"));var _Util=require("./Util");var _NavBar=require("./NavBar");var _LightboxRenderer=_interopRequireDefault(require("./LightboxRenderer"));var _menu_burger=_interopRequireDefault(require("../images/menu_burger.png"));var _State=require("./State");var _Modal=_interopRequireDefault(require("./Modal"));var _Lightbox=_interopRequireDefault(require("./Lightbox"));var _Drawer=_interopRequireDefault(require("./Drawer"));var _Tabs=_interopRequireDefault(require("./Tabs"));var _Overlay=_interopRequireDefault(require("./Overlay"));var _OverlayRenderer=_interopRequireDefault(require("./OverlayRenderer"));var _createStackNavigatorHOC=_interopRequireDefault(require("./createStackNavigatorHOC"));var _createTabNavigatorHOC=_interopRequireDefault(require("./createTabNavigatorHOC"));var _actionMap,_jsxFileName="/Users/ugurgumushan/Code/kontist/react-native-router-flux/src/Store.js";function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap();_getRequireWildcardCache=function _getRequireWildcardCache(){return cache;};return cache;}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance");}function _iterableToArray(iter){if((typeof Symbol==="function"?Symbol.iterator:"@@iterator")in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call;}return _assertThisInitialized(self);}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(Object(source));if(typeof Object.getOwnPropertySymbols==='function'){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable;}));}ownKeys.forEach(function(key){_defineProperty(target,key,source[key]);});}return target;}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var RightNavBarButton;var LeftNavBarButton;var BackNavBarButton;var counter=0;var actionMap=(_actionMap={},_defineProperty(_actionMap,ActionConst.JUMP,'jump'),_defineProperty(_actionMap,ActionConst.PUSH,'push'),_defineProperty(_actionMap,ActionConst.REPLACE,'replace'),_defineProperty(_actionMap,ActionConst.BACK,'pop'),_defineProperty(_actionMap,ActionConst.BACK_ACTION,'pop'),_defineProperty(_actionMap,ActionConst.POP_TO,'popTo'),_defineProperty(_actionMap,ActionConst.REFRESH,'refresh'),_defineProperty(_actionMap,ActionConst.RESET,'reset'),_defineProperty(_actionMap,ActionConst.PUSH_OR_POP,'push'),_actionMap);exports.actionMap=actionMap;var reservedKeys=['addRef','back','children','create','dispatch','drawerClose','drawerOpen','execute','left','leftButton','navBar','navigate','on','onEnter','onExit','onLeft','onRight','pop','popTo','push','refresh','refs','removeRef','renderLeftButton','renderRightButton','renderTitle','replace','right','rightButton','run','setParams','title'];var dontInheritKeys=['backToInitial','children','component','contentComponent','drawer','hideNavBar','hideTabBar','key','lightbox','modal','navigator','navTransparent','overlay','ref','style','tabBarComponent','tabs','title','type'];function getValue(value,params){return value instanceof Function?value(params):value;}function getProperties(){var component=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var res={};for(var _iterator=reservedKeys,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++];}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value;}var _key=_ref;if(component[_key]){res[_key]=component[_key];}}delete res.children;return res;}function createTabBarOptions(_ref2){var tabBarStyle=_ref2.tabBarStyle,activeTintColor=_ref2.activeTintColor,inactiveTintColor=_ref2.inactiveTintColor,activeBackgroundColor=_ref2.activeBackgroundColor,inactiveBackgroundColor=_ref2.inactiveBackgroundColor,showLabel=_ref2.showLabel,labelStyle=_ref2.labelStyle,tabStyle=_ref2.tabStyle,props=_objectWithoutProperties(_ref2,["tabBarStyle","activeTintColor","inactiveTintColor","activeBackgroundColor","inactiveBackgroundColor","showLabel","labelStyle","tabStyle"]);return _objectSpread({},props,{style:tabBarStyle,activeTintColor:activeTintColor,inactiveTintColor:inactiveTintColor,activeBackgroundColor:activeBackgroundColor,inactiveBackgroundColor:inactiveBackgroundColor,showLabel:showLabel,labelStyle:labelStyle,tabStyle:tabStyle});}function createNavigationOptions(params){var type=params.type,cardStyle=params.cardStyle,back=params.back,backButtonImage=params.backButtonImage,backButtonTextStyle=params.backButtonTextStyle,backTitle=params.backTitle,backTitleEnabled=params.backTitleEnabled,backToInitial=params.backToInitial,component=params.component,drawerIcon=params.drawerIcon,drawerImage=params.drawerImage,drawerPosition=params.drawerPosition,getTitle=params.getTitle,headerLayoutPreset=params.headerLayoutPreset,headerStyle=params.headerStyle,headerTitleStyle=params.headerTitleStyle,hideDrawerButton=params.hideDrawerButton,hideNavBar=params.hideNavBar,hideTabBar=params.hideTabBar,icon=params.icon,init=params.init,left=params.left,leftButton=params.leftButton,leftButtonImage=params.leftButtonImage,leftButtonTextStyle=params.leftButtonTextStyle,leftTitle=params.leftTitle,navBar=params.navBar,navBarButtonColor=params.navBarButtonColor,navigationBarStyle=params.navigationBarStyle,navigationBarTitleImage=params.navigationBarTitleImage,navigationBarTitleImageStyle=params.navigationBarTitleImageStyle,navTransparent=params.navTransparent,onLeft=params.onLeft,onRight=params.onRight,panHandlers=params.panHandlers,renderBackButton=params.renderBackButton,renderNavigationBar=params.renderNavigationBar,renderTitle=params.renderTitle,right=params.right,rightButton=params.rightButton,rightButtonImage=params.rightButtonImage,rightButtonTextStyle=params.rightButtonTextStyle,rightTitle=params.rightTitle,tabBarIcon=params.tabBarIcon,tabBarLabel=params.tabBarLabel,title=params.title,titleStyle=params.titleStyle,props=_objectWithoutProperties(params,["type","cardStyle","back","backButtonImage","backButtonTextStyle","backTitle","backTitleEnabled","backToInitial","component","drawerIcon","drawerImage","drawerPosition","getTitle","headerLayoutPreset","headerStyle","headerTitleStyle","hideDrawerButton","hideNavBar","hideTabBar","icon","init","left","leftButton","leftButtonImage","leftButtonTextStyle","leftTitle","navBar","navBarButtonColor","navigationBarStyle","navigationBarTitleImage","navigationBarTitleImageStyle","navTransparent","onLeft","onRight","panHandlers","renderBackButton","renderNavigationBar","renderTitle","right","rightButton","rightButtonImage","rightButtonTextStyle","rightTitle","tabBarIcon","tabBarLabel","title","titleStyle"]);var NavBar=renderNavigationBar||navBar;if(component&&component.navigationOptions){return component.navigationOptions;}return function(_ref3){var navigation=_ref3.navigation,screenProps=_ref3.screenProps;var navigationParams=navigation.state.params||{};var state=_objectSpread({navigation:navigation},params,navigationParams,screenProps);var res=_objectSpread({animationEnabled:!(type===ActionConst.REPLACE||type==='replace'||type===ActionConst.RESET||type==='reset')},props,{cardStyle:navigationParams.cardStyle||cardStyle,headerBackImage:navigationParams.backButtonImage||backButtonImage,headerBackTitle:getValue(navigationParams.backTitle||backTitle,state),headerBackTitleEnabled:navigationParams.backTitleEnabled||backTitleEnabled,headerLayoutPreset:navigationParams.headerLayoutPreset||headerLayoutPreset,headerLeft:function headerLeft(){return getValue(navigationParams.left||left||leftButton||params.renderLeftButton,state);},headerRight:function headerRight(){return getValue(navigationParams.right||right||rightButton||params.renderRightButton,state);},headerStyle:getValue(navigationParams.headerStyle||headerStyle||navigationBarStyle,state),headerTintColor:navBarButtonColor||props.tintColor||navigationParams.tintColor||navigationParams.headerTintColor,headerTitle:getValue(navigationParams.renderTitle||renderTitle||params.renderTitle,state),headerTitleStyle:headerTitleStyle||titleStyle,title:getValue(navigationParams.title||title||getTitle,state)});var NavBarFromParams=navigationParams.renderNavigationBar||navigationParams.navBar;if(NavBarFromParams!=null){if(NavBarFromParams){res.header=function(data){return _react.default.createElement(NavBarFromParams,_extends({navigation:navigation},state,data,{__source:{fileName:_jsxFileName,lineNumber:210}}));};}}else if(NavBar){res.header=function(data){return _react.default.createElement(NavBar,_extends({navigation:navigation},state,data,{__source:{fileName:_jsxFileName,lineNumber:213}}));};}if(typeof navigationParams.panHandlers!=='undefined'){if(navigationParams.panHandlers===null){res.gesturesEnabled=false;}}else if(panHandlers===null){res.gesturesEnabled=false;}if(navigationBarTitleImage){res.headerTitle=_react.default.createElement(_reactNative.Image,{source:navigationBarTitleImage,style:navigationBarTitleImageStyle,__source:{fileName:_jsxFileName,lineNumber:225}});}if(tabBarLabel){res.tabBarLabel=tabBarLabel;}if(tabBarIcon||icon){var Icon=tabBarIcon||icon;res.tabBarIcon=function(data){return _react.default.createElement(Icon,_extends({},state,data,{__source:{fileName:_jsxFileName,lineNumber:234}}));};}var componentData={};if(component){var _arr=['onRight','onLeft','rightButton','leftButton','leftTitle','rightTitle','rightButtonImage','leftButtonImage','rightButtonTextStyle','leftButtonTextStyle','rightButtonIconStyle','leftButtonIconStyle','leftButtonTintColor','rightButtonTintColor'];for(var _i2=0;_i2<_arr.length;_i2++){var _key2=_arr[_i2];if(component[_key2]){componentData[_key2]=component[_key2];}}}if(rightButtonImage||rightTitle||params.renderRightButton||onRight||navigationParams.onRight||navigationParams.rightTitle||navigationParams.rightButtonImage||rightButtonTextStyle||(drawerImage||drawerIcon)&&!hideDrawerButton&&drawerPosition==='right'){res.headerRight=function(){return getValue(navigationParams.right||navigationParams.rightButton||params.renderRightButton,_objectSpread({},navigationParams,screenProps))||_react.default.createElement(RightNavBarButton,_extends({navigation:navigation},params,navigationParams,componentData,{__source:{fileName:_jsxFileName,lineNumber:273}}));};}if(leftButtonImage||backButtonImage||backTitle||leftTitle||params.renderLeftButton||leftButtonTextStyle||renderBackButton||backButtonTextStyle||onLeft||navigationParams.leftTitle||navigationParams.onLeft||navigationParams.leftButtonImage||navigationParams.backButtonImage||navigationParams.backTitle||(drawerImage||drawerIcon)&&!hideDrawerButton&&drawerPosition!=='right'){var _leftButton=navigationParams.left||navigationParams.leftButton||params.renderLeftButton;res.headerLeft=function(){return getValue(_leftButton,_objectSpread({},params,navigationParams,screenProps))||(onLeft&&(leftTitle||navigationParams.leftTitle||leftButtonImage||navigationParams.leftButtonImage)||drawerImage||drawerIcon)&&_react.default.createElement(LeftNavBarButton,_extends({navigation:navigation},params,navigationParams,componentData,{__source:{fileName:_jsxFileName,lineNumber:297}}))||res.headerLeft||(init?null:!_leftButton&&renderBackButton&&renderBackButton(state)||!_leftButton&&_react.default.createElement(BackNavBarButton,_extends({navigation:navigation},state,{__source:{fileName:_jsxFileName,lineNumber:300}})))||null;};}if(back){res.headerLeft=renderBackButton&&renderBackButton(state)||function(){return _react.default.createElement(BackNavBarButton,_extends({navigation:navigation},state,{__source:{fileName:_jsxFileName,lineNumber:305}}));};}if(typeof navigationParams.left!=='undefined'||typeof navigationParams.leftButton!=='undefined'||typeof navigationParams.renderLeftButton!=='undefined'){if(navigationParams.left===null||navigationParams.leftButton===null||navigationParams.renderLeftButton===null){res.headerLeft=null;}}var routeParams=navigation.state.routes&&navigation.state.routes[navigation.state.index].params;if(navigationParams.hideTabBar!=null){if(navigationParams.hideTabBar){res.tabBarVisible=false;}}else if(hideTabBar){res.tabBarVisible=false;}else if(routeParams&&routeParams.hideTabBar){res.tabBarVisible=false;}if(navigationParams.hideNavBar!=null){if(navigationParams.hideNavBar){res.header=null;}}else if(hideNavBar){res.header=null;}if(navTransparent){res.headerTransparent=true;res.headerStyle={};}if(backToInitial){var userDefinedTabBarOnPress=res.tabBarOnPress;res.tabBarOnPress=function(data){if(userDefinedTabBarOnPress){console.warn('backToInitial and tabBarOnPress were both defined and might cause unexpected navigation behaviors. I hope you know what you are doing ;-)');userDefinedTabBarOnPress(data);}if(data.navigation&&data.navigation.state.index!==0){data.navigation.dispatch(_reactNavigation.StackActions.popToTop());}else{data.defaultHandler();}};}return res;};}function originalRouteName(routeName){if(routeName.startsWith('_')){return routeName.substring(1);}return routeName;}function isStatelessComponent(Component){return!Component.prototype||typeof Component.prototype.render!=='function';}function extendProps(props,store){if(!props){return{};}var res=_objectSpread({},props);var _loop=function _loop(transition){if(reservedKeys.indexOf(transition)===-1&&transition.startsWith('on')&&transition.charAt(2)>='A'&&transition.charAt(2)<='Z'&&typeof props[transition]==='string'){if(store[props[transition]]){res[transition]=function(params){return store[props[transition]](params);};}}};var _arr2=Object.keys(props);for(var _i3=0;_i3<_arr2.length;_i3++){var transition=_arr2[_i3];_loop(transition);}return res;}function createWrapper(Component,wrapBy,store){if(!Component){return null;}var wrapper=wrapBy||function(props){return props;};if(!isStatelessComponent(Component)){var Wrapped=function(_React$Component){function Wrapped(){var _this;_classCallCheck(this,Wrapped);_this=_possibleConstructorReturn(this,_getPrototypeOf(Wrapped).call(this));_this.onRef=_this.onRef.bind(_assertThisInitialized(_assertThisInitialized(_this)));return _this;}_createClass(Wrapped,[{key:"componentDidMount",value:function componentDidMount(){var navigation=this.props.navigation;if(this.ref&&navigation&&navigation.state&&navigation.state.routeName){store.addRef(originalRouteName(navigation.state.routeName),this.ref);}if(this.ref&&this.ref.onEnter){this.ref.onEnter(navigation&&navigation.state);}}},{key:"componentWillUnmount",value:function componentWillUnmount(){var navigation=this.props.navigation;if(this.ref&&navigation&&navigation.state&&navigation.state.routeName){store.deleteRef(originalRouteName(navigation.state.routeName));}if(this.ref&&this.ref.onExit){this.ref.onExit(navigation&&navigation.state);}this.ref=null;}},{key:"onRef",value:function onRef(ref){this.ref=ref;}},{key:"render",value:function render(){var navigation=this.props.navigation;if(!navigation||!navigation.state){return _react.default.createElement(Component,_extends({ref:this.onRef},this.props,{__source:{fileName:_jsxFileName,lineNumber:435}}));}return _react.default.createElement(Component,_extends({ref:this.onRef},this.props,extendProps(navigation.state.params,store),{name:navigation.state.routeName,__source:{fileName:_jsxFileName,lineNumber:437}}));}}]);_inherits(Wrapped,_React$Component);return Wrapped;}(_react.default.Component);Wrapped.propTypes={navigation:_propTypes.default.shape().isRequired};return wrapper(Wrapped);}function StatelessWrapped(_ref4){var navigation=_ref4.navigation,props=_objectWithoutProperties(_ref4,["navigation"]);return _react.default.createElement(Component,_extends({},props,{navigation:navigation},extendProps(navigation.state.params,store),{name:navigation.state.routeName,__source:{fileName:_jsxFileName,lineNumber:445}}));}StatelessWrapped.propTypes={navigation:_propTypes.default.shape().isRequired};return wrapper(StatelessWrapped);}function filterParam(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(data.toString()!=='[object Object]'){return{data:data};}var proto=(data||{}).constructor.name;if(!data||proto!=='Object'){return{};}return data;}function uniteParams(routeName,params){var res={};for(var _iterator2=params,_isArray2=Array.isArray(_iterator2),_i4=0,_iterator2=_isArray2?_iterator2:_iterator2[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var _ref5;if(_isArray2){if(_i4>=_iterator2.length)break;_ref5=_iterator2[_i4++];}else{_i4=_iterator2.next();if(_i4.done)break;_ref5=_i4.value;}var _param=_ref5;if(_param){res=_objectSpread({},res,filterParam(_param));}}res.routeName=routeName;return res;}var defaultSuccess=function defaultSuccess(){};var defaultFailure=function defaultFailure(){};var NavigationStore=function(){function NavigationStore(){var _this2=this;_classCallCheck(this,NavigationStore);this.getStateForAction=null;this.reducer=null;this._navigator=null;this.externalDispatch=null;this.externalState=null;this.prevState=null;this.externalAction={};this.refs={};this.states={};this.isLogical={};this.setCustomReducer=function(Navigator){_this2.getStateForAction=Navigator.router.getStateForAction;var reducer=(0,_Reducer.default)(_this2);Navigator.router.getStateForAction=function(cmd,state){return _this2.reducer?_this2.reducer(state,cmd):reducer(state,cmd);};};this.onEnterHandler=function _callee(currentScene){var handler,success,failure,res;return regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!_this2.states[currentScene]){_context.next=15;break;}handler=_this2[currentScene+_Util.OnEnter];success=_this2.states[currentScene].success||defaultSuccess;failure=_this2.states[currentScene].failure||defaultFailure;if(!handler){_context.next=15;break;}_context.prev=5;_context.next=8;return regeneratorRuntime.awrap(handler(_this2.currentParams,_this2.state));case 8:res=_context.sent;if(res){success(res);}else{failure();}_context.next=15;break;case 12:_context.prev=12;_context.t0=_context["catch"](5);failure({error:_context.t0.message});case 15:case"end":return _context.stop();}}},null,this,[[5,12]]);};this.onExitHandler=function(prevScene){if(prevScene){var exitHandler=_this2[prevScene+_Util.OnExit];if(exitHandler){try{var res=exitHandler(_this2.state);if(res instanceof Promise){res.then(defaultSuccess,defaultFailure);}}catch(e){console.error('Error during onExit handler:',e);}}}};this.onNavigationStateChange=function _callee2(prevState,currentState,action){var activeState,currentScene,routeName;return regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this2.state=currentState;_this2.prevState=prevState;activeState=(0,_State.getActiveState)(_this2.state);currentScene=activeState.routeName;_this2.currentParams=_objectSpread({},activeState.params,action.params);_this2.currentScene=currentScene;_this2.prevScene=_this2.prevState?(0,_State.getActiveState)(_this2.prevState).routeName:null;if(_this2.currentScene!==_this2.prevScene){_this2.onExitHandler(_this2.prevScene);setTimeout(function(){return _this2.dispatch({type:ActionConst.FOCUS,routeName:_this2.currentScene,params:_this2.currentParams});});_this2.onEnterHandler(currentScene);}else{routeName=(0,_State.getRouteNameByKey)(_this2.state,action.key);if(action.type==='Navigation/DRAWER_OPENED'){_this2.onEnterHandler(routeName);}else if(action.type==='Navigation/DRAWER_CLOSED'){_this2.onExitHandler(routeName);}}if(_this2.onStateChange){_this2.onStateChange(prevState,currentState,action);}case 9:case"end":return _context2.stop();}}},null,this);};this.setTopLevelNavigator=function(navigatorRef){_this2._navigator=navigatorRef;};this.addRef=function(name,ref){_this2.refs[name]=ref;};this.deleteRef=function(name){delete _this2.refs[name];};this.create=function(scene){var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var wrapBy=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(props){return props;};(0,_Util.assert)(!Array.isArray(scene),'Router should contain only one scene, please wrap your scenes with root Scene ');RightNavBarButton=wrapBy(_NavBar.RightButton);LeftNavBarButton=wrapBy(_NavBar.LeftButton);BackNavBarButton=wrapBy(_NavBar.BackButton);var Navigator=_this2.processScene(scene,params,[],wrapBy);_this2.onNavigationStateChange(null,Navigator.router.getStateForAction(_reactNavigation.NavigationActions.init()),_reactNavigation.NavigationActions.init());_this2.setCustomReducer(Navigator);return(0,_reactNavigation.createAppContainer)(Navigator);};this.createAction=function(name){return function(args){if(_this2.isLogical[name]){_this2[name](args);}else{setTimeout(function(){return _this2[name](args);});}};};this.processScene=function(scene){var _ref6;var inheritProps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var clones=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var wrapBy=arguments.length>3?arguments[3]:undefined;(0,_Util.assert)(scene.props,'props should be defined');if(!scene.props.children){return null;}var res={};var order=[];var _scene$props=scene.props,navigator=_scene$props.navigator,renderer=_scene$props.renderer,contentComponent=_scene$props.contentComponent,drawerWidth=_scene$props.drawerWidth,drawerLockMode=_scene$props.drawerLockMode,tabBarPosition=_scene$props.tabBarPosition,lazy=_scene$props.lazy,duration=_scene$props.duration,parentProps=_objectWithoutProperties(_scene$props,["navigator","renderer","contentComponent","drawerWidth","drawerLockMode","tabBarPosition","lazy","duration"]);var tabs=parentProps.tabs,modal=parentProps.modal,lightbox=parentProps.lightbox,overlay=parentProps.overlay,drawer=parentProps.drawer,transitionConfig=parentProps.transitionConfig,tabBarComponent=parentProps.tabBarComponent;if(scene.type===_Modal.default){modal=true;}else if(scene.type===_Drawer.default){drawer=true;}else if(scene.type===_Lightbox.default){lightbox=true;}else if(scene.type===_Tabs.default){tabs=true;}else if(scene.type===_Overlay.default){overlay=true;}if(duration!==undefined&&!transitionConfig){transitionConfig=function transitionConfig(){return{transitionSpec:{duration:duration,timing:_reactNative.Animated.timing,easing:_reactNative.Easing.step0}};};}var commonProps=_objectSpread({},inheritProps,parentProps);delete commonProps.children;delete commonProps.component;var _arr3=Object.keys(commonProps);for(var _i5=0;_i5<_arr3.length;_i5++){var pkey=_arr3[_i5];if(dontInheritKeys.includes(pkey)&&(pkey==='type'||pkey==='hideNavBar'||!parentProps[pkey])){delete commonProps[pkey];}}if(drawer){commonProps.drawerImage=commonProps.drawerImage||_menu_burger.default;}var children=!Array.isArray(parentProps.children)?[parentProps.children]:(_ref6=[]).concat.apply(_ref6,_toConsumableArray(parentProps.children));if(!drawer&&!tabs&&!overlay){children.push.apply(children,_toConsumableArray(clones));}for(var _iterator3=children,_isArray3=Array.isArray(_iterator3),_i6=0,_iterator3=_isArray3?_iterator3:_iterator3[typeof Symbol==="function"?typeof Symbol==="function"?typeof Symbol==="function"?Symbol.iterator:"@@iterator":"@@iterator":"@@iterator"]();;){var _ref7;if(_isArray3){if(_i6>=_iterator3.length)break;_ref7=_iterator3[_i6++];}else{_i6=_iterator3.next();if(_i6.done)break;_ref7=_i6.value;}var _child2=_ref7;if(_child2&&_child2.props.clone){if(clones.indexOf(_child2)===-1){clones.push(_child2);}}}var initialRouteName;var initialRouteParams;for(var _iterator4=children,_isArray4=Array.isArray(_iterator4),_i7=0,_iterator4=_isArray4?_iterator4:_iterator4[typeof Symbol==="function"?typeof Symbol==="function"?typeof Symbol==="function"?Symbol.iterator:"@@iterator":"@@iterator":"@@iterator"]();;){var _ref8;if(_isArray4){if(_i7>=_iterator4.length)break;_ref8=_iterator4[_i7++];}else{_i7=_iterator4.next();if(_i7.done)break;_ref8=_i7.value;}var _child3=_ref8;if(!_child3){continue;}var _key4=_child3.key||"key"+(counter+=1);var init=_key4===children[0].key;(0,_Util.assert)(reservedKeys.indexOf(_key4)===-1,"Scene name cannot be reserved word: "+_child3.key);var _child3$props=_child3.props,component=_child3$props.component,_child3$props$type=_child3$props.type,type=_child3$props$type===void 0?tabs||drawer?'jump':'push':_child3$props$type,path=_child3$props.path,onEnter=_child3$props.onEnter,onExit=_child3$props.onExit,on=_child3$props.on,failure=_child3$props.failure,success=_child3$props.success,wrap=_child3$props.wrap,_child3$props$initial=_child3$props.initial,initial=_child3$props$initial===void 0?false:_child3$props$initial,props=_objectWithoutProperties(_child3$props,["component","type","path","onEnter","onExit","on","failure","success","wrap","initial"]);if(!_this2.states[_key4]){_this2.states[_key4]={};}var _arr4=Object.keys(props);for(var _i8=0;_i8<_arr4.length;_i8++){var transition=_arr4[_i8];if(reservedKeys.indexOf(transition)===-1&&props[transition]instanceof Function){_this2.states[_key4][transition]=props[transition];}}delete props.children;if(success){_this2.states[_key4].success=success instanceof Function?success:_this2.createAction(success);}if(failure){_this2.states[_key4].failure=failure instanceof Function?failure:_this2.createAction(failure);}if(path){_this2.states[_key4].path=path;}var screen={screen:createWrapper(component,wrapBy,_this2)||_this2.processScene(_child3,commonProps,clones)||lightbox&&function(){return null;},navigationOptions:createNavigationOptions(_objectSpread({},commonProps,{hideNavBar:parentProps.hideNavBar},getProperties(component),_child3.props,{init:init,component:component}))};var wrapNavBar=drawer||tabs&&!navigator&&!renderer||wrap;if(wrap===false||commonProps.wrap===false){wrapNavBar=false;}if(component&&wrapNavBar){res[_key4]={screen:_this2.processScene({key:_key4,props:{children:{key:"_"+_key4,props:_objectSpread({},_child3.props,{wrap:false})}}},commonProps,clones,wrapBy),navigationOptions:createNavigationOptions(_objectSpread({},commonProps,_child3.props,{hideNavBar:true}))};}else{res[_key4]=screen;}props.init=true;if(!_this2[_key4]){_this2.isLogical[_key4]=!!component;_this2[_key4]=new Function('actions','props','type',"return function "+_key4.replace(/\W/g,'_')+"(params){ actions.execute(type, '"+_key4+"', props, params)}")(_this2,_objectSpread({error:''},commonProps,props),type);}if((onEnter||on||component&&component.onEnter)&&!_this2[_key4+_Util.OnEnter]){_this2[_key4+_Util.OnEnter]=onEnter||on||component.onEnter;}if((onExit||component&&component.onExit)&&!_this2[_key4+_Util.OnExit]){_this2[_key4+_Util.OnExit]=onExit||component.onExit;}order.push(_key4);if(initial||_child3.props.initial||!initialRouteName){initialRouteName=_key4;initialRouteParams=_objectSpread({},commonProps,props);}}var mode=modal?'modal':'card';var navigationConfig=_objectSpread({lazy:lazy,initialRouteName:initialRouteName,initialRouteParams:initialRouteParams,contentComponent:contentComponent,order:order},commonProps,{navigationOptions:createNavigationOptions(commonProps)});if(navigator){return navigator(res,navigationConfig);}if(renderer){return tabs?(0,_createTabNavigatorHOC.default)(renderer)(res,navigationConfig):(0,_createStackNavigatorHOC.default)(renderer)(res,navigationConfig);}if(lightbox){return(0,_createStackNavigatorHOC.default)(_LightboxRenderer.default)(res,_objectSpread({mode:mode,initialRouteParams:initialRouteParams,initialRouteName:initialRouteName},commonProps,{navigationOptions:createNavigationOptions(commonProps)}));}if(tabs){var createTabNavigator=_reactNavigationTabs.createMaterialTopTabNavigator;if(tabBarPosition!=='top'){createTabNavigator=_reactNavigationTabs.createBottomTabNavigator;}return createTabNavigator(res,_objectSpread({lazy:lazy,tabBarComponent:tabBarComponent,initialRouteName:initialRouteName,initialRouteParams:initialRouteParams,tabBarPosition:tabBarPosition,order:order},commonProps,{tabBarOptions:createTabBarOptions(commonProps),navigationOptions:createNavigationOptions(commonProps)}));}if(drawer){var config=_objectSpread({initialRouteName:initialRouteName,contentComponent:contentComponent,order:order,drawerOpenRoute:'DrawerOpen',drawerCloseRoute:'DrawerClose',drawerToggleRoute:'DrawerToggle'},commonProps);if(drawerWidth){config.drawerWidth=drawerWidth;}if(drawerLockMode){config.drawerLockMode=drawerLockMode;}return(0,_reactNavigationDrawer.createDrawerNavigator)(res,config);}if(overlay){return(0,_createTabNavigatorHOC.default)(_OverlayRenderer.default)(res,_objectSpread({lazy:lazy,initialRouteName:initialRouteName,contentComponent:contentComponent,initialRouteParams:initialRouteParams,order:order},commonProps,{tabBarOptions:createTabBarOptions(commonProps),navigationOptions:createNavigationOptions(commonProps)}));}return(0,_reactNavigationStack.createStackNavigator)(res,_objectSpread({mode:mode,initialRouteParams:initialRouteParams,initialRouteName:initialRouteName},commonProps,{transitionConfig:transitionConfig,navigationOptions:createNavigationOptions(commonProps)}));};this.dispatch=function(action){if(_this2.externalDispatch){_this2.externalAction=action;_this2.externalDispatch(action);}else if(_this2._navigator){_this2._navigator.dispatch(action);}};this.execute=function(actionType,routeName){for(var _len=arguments.length,params=new Array(_len>2?_len-2:0),_key5=2;_key5<_len;_key5++){params[_key5-2]=arguments[_key5];}var res=uniteParams(routeName,params);var overridenType=res.type||actionType;var type=actionMap[overridenType]||overridenType;if(type==='pop'){_this2[type](res);}else{_this2[type](routeName,res);}};this.push=function(routeName,data){var params=filterParam(data);_this2.dispatch({type:_reactNavigation.StackActions.PUSH,routeName:routeName,params:params});};this.jump=function(routeName,data){var params=filterParam(data);_this2.dispatch({type:_reactNavigation.NavigationActions.NAVIGATE,routeName:routeName,params:params});};this.drawerOpen=function(){_this2.dispatch(_reactNavigationDrawer.DrawerActions.openDrawer());};this.drawerClose=function(){_this2.dispatch(_reactNavigationDrawer.DrawerActions.closeDrawer());};this.drawerToggle=function(){_this2.dispatch(_reactNavigationDrawer.DrawerActions.toggleDrawer());};this.refresh=function(data){var sceneKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var params=filterParam(data);var _getActiveState=(0,_State.getActiveState)(_this2.state),key=_getActiveState.key;_this2.dispatch(_reactNavigation.NavigationActions.setParams({key:sceneKey||key,params:params}));};this.pop=function(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},timeout=_ref9.timeout,key=_ref9.key,params=_objectWithoutProperties(_ref9,["timeout","key"]);var res=filterParam(params);if(timeout){setTimeout(function(){return _this2.pop(params);},timeout);}else{_this2.dispatch(_reactNavigation.NavigationActions.back({key:key}));if(res.refresh){_this2.refresh(res.refresh);}}return true;};this.popTo=function(routeName,data){var params=filterParam(data);_this2.dispatch({type:ActionConst.POP_TO,routeName:routeName,params:params});};this.popAndPush=function(routeName,data){var params=filterParam(data);_this2.dispatch({type:ActionConst.POP_AND_PUSH,routeName:routeName,params:params});};this.replace=function(routeName,data){var params=filterParam(data);_this2.dispatch({type:ActionConst.REPLACE,routeName:routeName,params:params});};this.reset=function(routeName,data){var params=filterParam(data);var parent=(0,_State.getParent)(_this2.state,routeName);_this2.dispatch(_reactNavigation.StackActions.reset({index:0,key:parent?parent.key:null,actions:[_reactNavigation.NavigationActions.navigate({routeName:routeName,params:params})]}));};}_createClass(NavigationStore,[{key:"externalState",set:function set(state){if(state&&this.externalDispatch){this.onNavigationStateChange(this.state,state,this.externalAction);this.state=state;}}}]);return NavigationStore;}();exports.default=NavigationStore;